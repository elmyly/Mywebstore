{% extends 'base.html' %}
{% block title %}Order Lookup â€” Admin{% endblock %}
{% block content %}
  <section class="section admin order-lookup">
    <div class="title-row">
      <h2 class="section-title">ðŸ”Ž Order Lookup</h2>
    </div>
    <div class="lookup-hero">
      <form method="post" class="lookup-form" autocomplete="off">
        <input class="lookup-input" name="order_code" placeholder="Order code (8 digits) or ID" autofocus required />
        <button class="lookup-btn" aria-label="Search">Search</button>
      </form>
    </div>

    {% if order %}
    <div class="card result-card">
      <div class="ticket-bar">
        <div class="code-chip" title="Tracking code">{{ public_code }}</div>
        <div class="when">{{ order['created_at'][:19].replace('T',' ') }}</div>
      </div>

      <!-- Simple key/value table -->
      <div class="table compact">
        <div class="thead">
          <div>Field</div>
          <div>Value</div>
        </div>
        <div class="trow"><div>Date</div><div>{{ order['created_at'][:19].replace('T',' ') }}</div></div>
        <div class="trow"><div>Status</div><div class="badge status {{ order['status'] }}">{{ order['status'] }}</div></div>
        <div class="trow"><div>Customer</div><div>{{ order['customer_name'] }}</div></div>
        <div class="trow"><div>Email / Phone</div><div>{{ order['email'] or 'â€”' }} â€¢ {{ order['phone'] or 'â€”' }}</div></div>
        <div class="trow"><div>Address</div><div>{{ order['address'] or 'â€”' }}</div></div>
        <div class="trow"><div>City / Country</div><div>{{ order['city'] }}, {{ order['country'] }}</div></div>
        <div class="trow"><div>Items</div><div>{{ items|length }}</div></div>
        <div class="trow total"><div>Total</div><div>{{ price(order['total_cents']) }}</div></div>
      </div>

      <!-- Items table -->
      <h3 class="section-title small" style="margin-top:12px">Items</h3>
      <div class="table compact">
        <div class="thead">
          <div>Title</div>
          <div>Qty</div>
          <div>Unit</div>
          <div>Line</div>
        </div>
        {% for i in items %}
          <div class="trow">
            <div>{{ i['title'] }}</div>
            <div>{{ i['quantity'] }}</div>
            <div>{{ price(i['price_cents']) }}</div>
            <div>{{ price(i['line_total']) }}</div>
          </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </section>

  <style>
    .order-lookup .lookup-hero{max-width:700px; margin:0 auto 14px; padding:0}
    .order-lookup .lookup-form{display:flex; gap:10px; align-items:center}
    .order-lookup .lookup-input{flex:1; font-size:16px; padding:10px 14px 10px 40px; border:1px solid var(--border); border-radius:12px; background:#fff; background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position:12px center}
    .order-lookup .lookup-input:focus{outline:none; box-shadow:0 0 0 3px color-mix(in oklab, var(--brand-a) 22%, transparent)}
    .order-lookup .lookup-btn{display:inline-flex; align-items:center; justify-content:center; padding:10px 14px; border:1px solid var(--border); border-radius:12px; background:#fff; color:var(--text); cursor:pointer; font-weight:700}
    .order-lookup .result-card{max-width:900px; margin:10px auto 0}
    .order-lookup .ticket-bar{display:flex; gap:10px; align-items:center; justify-content:space-between; margin-bottom:8px}
    .order-lookup .code-chip{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; letter-spacing:1px; padding:6px 10px; border-radius:10px; color:var(--brand-a); background:#fff; border:1px solid color-mix(in oklab, var(--brand-a) 40%, var(--border))}
    .order-lookup .when{color:var(--muted); font-size:12px}
    .order-lookup .table.compact .thead, .order-lookup .table.compact .trow{grid-template-columns: 1.2fr 2.8fr}
    .order-lookup h3.section-title.small{margin:8px 0}
  </style>
{% endblock %}
