{% extends 'base.html' %}
{% block title %}Votre panier — Bghitha{% endblock %}
{% block content %}
  <section class="section">
    <h2 class="section-title">Votre panier</h2>
    {% if items %}
    <form method="post" action="{{ url_for('update_cart') }}">
      <div class="table zebra">
        <div class="thead">
          <div>Produit</div>
          <div>Prix</div>
          <div>Qté</div>
          <div>Sous‑total</div>
          <div></div>
        </div>
        {% for item in items %}
          <div class="trow">
            <div class="p-info">
              {% set primary = (item['images'][0] if item['images'] else None) %}
              {% if primary %}<img src="{{ url_for('static', filename=primary) }}" alt="thumb">{% endif %}
              <div>{{ item['title'] }}</div>
            </div>
            <div>
              {% if item['discount_cents'] and item['discount_cents'] < item['orig_price_cents'] %}
                <span class="old-price">{{ price(item['orig_price_cents']) }}</span>
                <span class="new-price">{{ price(item['price_cents']) }}</span>
              {% else %}
                {{ price(item['price_cents']) }}
              {% endif %}
            </div>
            <div>
              <input type="number" name="qty_{{ item['id'] }}" min="1" value="{{ item['quantity'] }}" />
            </div>
            <div>{{ price(item['line_total']) }}</div>
            <div><a class="link danger" href="{{ url_for('remove_from_cart', pid=item['id']) }}">Retirer</a></div>
          </div>
        {% endfor %}
      </div>
      <div class="cart-actions">
        <div class="total">Total : <strong>{{ price(total_cents) }}</strong></div>
        <div>
          <button class="btn">Mettre à jour</button>
          <a class="btn primary" href="{{ url_for('checkout') }}">Commander</a>
        </div>
      </div>
    </form>
    {% else %}
      <div class="empty">Votre panier est vide.</div>
    {% endif %}
  </section>
{% endblock %}
